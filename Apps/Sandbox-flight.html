<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Configure viewer to add a button enabling look at a mobile device with cardboard.">
    <meta name="cesium-sandcastle-labels" content="Beginner, Showcases">
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script type="text/javascript" src="../../../ThirdParty/requirejs-2.1.20/require.js"></script>
    <script type="text/javascript">
    require.config({
        baseUrl : '../../../Source',
        waitSeconds : 60
    });
    </script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<style>
    @import url(../templates/bucket.css);
</style>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar"></div>
<script id="cesium_sandcastle_script">
function startup(Cesium) {
    'use strict';
//Sandcastle_Begin
var viewer = new Cesium.Viewer('cesiumContainer', {
      vrButton : true
  });
  // Click the VR button in the bottom right of the screen to switch to VR mode.




function addBillboard() {
    Sandcastle.declare(addBillboard);

    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard :{
            image : '../images/Cesium_Logo_overlay.png'
        }
    });
}

function addMarker(position){
    Sandcastle.declare(addMarker);
    viewer.entities.add({
        position : position,
        billboard : {
            image : '../images/whiteShapes.png',
            imageSubRegion : new Cesium.BoundingRectangle(105, 105, 18, 18),
            color : Cesium.Color.YELLOW
            }
        });
}
    

function setBillboardProperties() {
    Sandcastle.declare(setBillboardProperties);

    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard : {
            image : '../images/Cesium_Logo_overlay.png', // default: undefined
            show : true, // default
            pixelOffset : new Cesium.Cartesian2(0, -50), // default: (0, 0)
            eyeOffset : new Cesium.Cartesian3(0.0, 0.0, 0.0), // default
            horizontalOrigin : Cesium.HorizontalOrigin.CENTER, // default
            verticalOrigin : Cesium.VerticalOrigin.BOTTOM, // default: CENTER
            scale : 2.0, // default: 1.0
            color : Cesium.Color.LIME, // default: WHITE
            rotation : Cesium.Math.PI_OVER_FOUR, // default: 0.0
            alignedAxis : Cesium.Cartesian3.ZERO, // default
            width : 100, // default: undefined
            height : 25 // default: undefined
        }
    });
}

function changeBillboardProperties() {
    Sandcastle.declare(changeBillboardProperties);

    var entity = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883, 300000.0),
        billboard : {
            image : '../images/Cesium_Logo_overlay.png'
        }
    });

    var billboard = entity.billboard;
    billboard.scale = 3.0;
    billboard.color = Cesium.Color.WHITE.withAlpha(0.25);
}

function sizeBillboardInMeters() {
    Sandcastle.declare(sizeBillboardInMeters);
    
    var entity = viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard : {
            image : '../images/Cesium_Logo_overlay.png',
            sizeInMeters : true
        }
    });
    
    viewer.zoomTo(entity);
}

function addMultipleBillboards() {
    Sandcastle.declare(addMultipleBillboards);

    var logoUrl = '../images/Cesium_Logo_overlay.png';
    var facilityUrl = '../images/facility.gif';

    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard : {
            image : logoUrl
        }
    });
    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-80.50, 35.14),
        billboard : {
            image : facilityUrl
        }
    });
    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-80.12, 25.46),
        billboard : {
            image : facilityUrl
        }
    });
}

function scaleByDistance() {
    Sandcastle.declare(scaleByDistance);

    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard : {
            image : '../images/facility.gif',
            scaleByDistance : new Cesium.NearFarScalar(1.5e2, 2.0, 1.5e7, 0.5)
        }
    });
}

function fadeByDistance() {
    Sandcastle.declare(fadeByDistance);

    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard : {
            image : '../images/Cesium_Logo_overlay.png',
            translucencyByDistance : new Cesium.NearFarScalar(1.5e2, 2.0, 1.5e7, 0.5)
        }
    });
}

function offsetByDistance() {
    Sandcastle.declare(offsetByDistance);
    Cesium.when.all([
         Cesium.loadImage('../images/Cesium_Logo_overlay.png'),
         Cesium.loadImage('../images/facility.gif')
        ],
        function(images) {
            // As viewer zooms closer to facility billboard,
            // increase pixelOffset on CesiumLogo billboard to this height
            var facilityHeight = images[1].height;

            // colocated billboards, separate as viewer gets closer
            viewer.entities.add({
                position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
                billboard : {
                    image : images[1],
                    horizontalOrigin : Cesium.HorizontalOrigin.CENTER,
                    verticalOrigin : Cesium.VerticalOrigin.BOTTOM
                }
            });
            viewer.entities.add({
                position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
                billboard : {
                    image : images[0],
                    horizontalOrigin : Cesium.HorizontalOrigin.CENTER,
                    verticalOrigin : Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset : new Cesium.Cartesian2(0.0, -facilityHeight),
                    pixelOffsetScaleByDistance : new Cesium.NearFarScalar(1.0e3, 1.0, 1.5e6, 0.0),
                    translucencyByDistance : new Cesium.NearFarScalar(1.0e3, 1.0, 1.5e6, 0.1)
                }
            });
    });
}

function addMarkerBillboards() {
    Sandcastle.declare(addMarkerBillboards);

    // Add several billboards based on the above image in the atlas.
    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
        billboard : {
            image : '../images/whiteShapes.png',
            imageSubRegion : new Cesium.BoundingRectangle(49, 43, 18, 18),
            color : Cesium.Color.LIME
        }
    });
    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-84.0, 39.0),
        billboard : {
            image : '../images/whiteShapes.png',
            imageSubRegion : new Cesium.BoundingRectangle(61, 23, 18, 18),
            color : new Cesium.Color(0, 0.5, 1.0, 1.0)
        }
    });
    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-70.0, 41.0),
        billboard : {
            image : '../images/whiteShapes.png',
            imageSubRegion : new Cesium.BoundingRectangle(67, 80, 14, 14),
            color : new Cesium.Color(0.5, 0.9, 1.0, 1.0)
        }
    });
    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-73.0, 37.0),
        billboard : {
            image : '../images/whiteShapes.png',
            imageSubRegion : new Cesium.BoundingRectangle(27, 103, 22, 22),
            color : Cesium.Color.RED
        }
    });
    viewer.entities.add({
        position : Cesium.Cartesian3.fromDegrees(-79.0, 35.0),
        billboard : {
            image : '../images/whiteShapes.png',
            imageSubRegion : new Cesium.BoundingRectangle(105, 105, 18, 18),
            color : Cesium.Color.YELLOW
        }
    });
}

function addMarkerBetter(lon, lat){
 
    var balloon = viewer.entities.add({
        availability : new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({
            start : start,
            stop : stop
        })]),
        position : computeStaticFlight(lon,lat),
        
        billboard : {
            image : '../images/whiteShapes.png',
            imageSubRegion : new Cesium.BoundingRectangle(105, 105, 18, 18),
            color : Cesium.Color.YELLOW
        }
        
    });

    balloon.position.setInterpolationOptions({
        interpolationDegree : 2,
        interpolationAlgorithm : Cesium.HermitePolynomialApproximation
    });   
}


  viewer.scene.globe.enableLighting = true;

  viewer.terrainProvider = new Cesium.CesiumTerrainProvider({
      url : 'https://assets.agi.com/stk-terrain/world',
      requestVertexNormals : true
  });

  viewer.scene.globe.depthTestAgainstTerrain = true;

  var start = Cesium.JulianDate.fromDate(new Date(2017, 4, 30, 11));
  var stop = Cesium.JulianDate.addSeconds(start, 360, new Cesium.JulianDate());

  viewer.clock.startTime = start.clone();
  viewer.clock.stopTime = stop.clone();
  viewer.clock.currentTime = start.clone();
  viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP;
  viewer.clock.multiplier = 0.5;


function computeStaticFlight(lon, lat){
    var property = new Cesium.SampledPositionProperty();
    for (var i = 0; i <= 360; i += 30) {
        var time = Cesium.JulianDate.addSeconds(start, i, new Cesium.JulianDate());
        var position = Cesium.Cartesian3.fromDegrees(lon, lat, 1000);
        
        property.addSample(time, position);       
    }
    return property;
}


function computeCirclularFlight(lon, lat, radius) {
    var property = new Cesium.SampledPositionProperty();
    for (var i = 0; i <= 360; i += 30) {
        var radians = Cesium.Math.toRadians(i);
        var time = Cesium.JulianDate.addSeconds(start, i, new Cesium.JulianDate());
        var position = Cesium.Cartesian3.fromDegrees(lon + (radius * 1.5 * Math.cos(radians)), lat + (radius * Math.sin(radians)), 1000);
        
        property.addSample(time, position);       
        //addMarker(position);
        addMarkerBetter(lon + (radius * 1.5 * Math.cos(radians)), lat + (radius * Math.sin(radians)));
        
    }
    return property;
}

  var longitude = -80.5449;
  var latitude = 43.4723;
  var radius = 1.03;


  //var modelURI = 'Cesium_Air.glb';
    var modelURI = '../../SampleData/models/CesiumAir/Cesium_Air.glb';

    var pos = computeCirclularFlight(longitude, latitude, radius);


  var entity = viewer.entities.add({
      availability : new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({
          start : start,
          stop : stop
      })]),
      position : pos,
      
      //Automatically compute orientation based on position movement.
      orientation : new Cesium.VelocityOrientationProperty(pos),
      
      model : {
          uri : modelURI,
          minimumPixelSize : 64
      }
  });

  entity.position.setInterpolationOptions({
      interpolationDegree : 2,
      interpolationAlgorithm : Cesium.HermitePolynomialApproximation
  });



  // Set initial camera position and orientation to be when in the model's reference frame.
  var camera = viewer.camera;
  camera.position = new Cesium.Cartesian3(-50, 0.0, 5);
  camera.direction = new Cesium.Cartesian3(1.0, 0.0, 0.0);
  camera.up = new Cesium.Cartesian3(0.0, 0.0, 1.0);
  camera.right = new Cesium.Cartesian3(0.0, -1.0, 0.0);



  viewer.scene.preRender.addEventListener(function(scene, time) {
      var position = entity.position.getValue(time);
      if (!Cesium.defined(position)) {
          return;
      }

      var transform;
      if (!Cesium.defined(entity.orientation)) {
          transform = Cesium.Transforms.eastNorthUpToFixedFrame(position);
      } else {
          var orientation = entity.orientation.getValue(time);
          if (!Cesium.defined(orientation)) {
              return;
          }

          transform = Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(orientation), position);
      }

      
      // Save camera state
      var offset = Cesium.Cartesian3.clone(camera.position);
      var direction = Cesium.Cartesian3.clone(camera.direction);
      var up = Cesium.Cartesian3.clone(camera.up);

      // Set camera to be in model's reference frame.
      camera.lookAtTransform(transform);

      // Reset the camera state to the saved state so it appears fixed in the model's frame.
      
      Cesium.Cartesian3.clone(offset, camera.position);
      Cesium.Cartesian3.clone(direction, camera.direction);
      Cesium.Cartesian3.clone(up, camera.up);
      Cesium.Cartesian3.cross(direction, up, camera.right);
      
      
  });

//addBillboard();

var pinBuilder = new Cesium.PinBuilder();

var bluePin = viewer.entities.add({
    name : 'Blank blue pin',
    position : Cesium.Cartesian3.fromDegrees(-75.170726, 39.9208667),
    billboard : {
        image : pinBuilder.fromColor(Cesium.Color.ROYALBLUE, 48).toDataURL(),
        verticalOrigin : Cesium.VerticalOrigin.BOTTOM
    }
});

var questionPin = viewer.entities.add({
    name : 'Question mark',
    position : Cesium.Cartesian3.fromDegrees(-75.1698529, 39.9220071),
    billboard : {
        image : pinBuilder.fromText('?', Cesium.Color.BLACK, 48).toDataURL(),
        verticalOrigin : Cesium.VerticalOrigin.BOTTOM
    }
});

var url = Cesium.buildModuleUrl('Assets/Textures/maki/grocery.png');
var groceryPin = Cesium.when(pinBuilder.fromUrl(url, Cesium.Color.GREEN, 48), function(canvas) {
    return viewer.entities.add({
        name : 'Grocery store',
        position : Cesium.Cartesian3.fromDegrees(-75.1705217, 39.921786),
        billboard : {
            image : canvas.toDataURL(),
            verticalOrigin : Cesium.VerticalOrigin.BOTTOM
        }
    });
});

//Create a red pin representing a hospital from the maki icon set.
var hospitalPin = Cesium.when(pinBuilder.fromMakiIconId('hospital', Cesium.Color.RED, 48), function(canvas) {
    return viewer.entities.add({
        name : 'Hospital',
        position : Cesium.Cartesian3.fromDegrees(-80.5122, 43.4563),
        billboard : {
            image : canvas.toDataURL(),
            verticalOrigin : Cesium.VerticalOrigin.BOTTOM
        }
    });
});

/*
//Since some of the pins are created asynchronously, wait for them all to load before zooming/
Cesium.when.all([bluePin, questionPin, groceryPin, hospitalPin], function(pins){
    viewer.zoomTo(pins);
});

*///Sandcastle_End
    Sandcastle.finishedLoading();
}
if (typeof Cesium !== "undefined") {
    startup(Cesium);
} else if (typeof require === "function") {
    require(["Cesium"], startup);
}
</script>
</body>
</html>
